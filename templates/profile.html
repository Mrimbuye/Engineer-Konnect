{% extends "base.html" %}

{% block title %}Profile - Engineer Konnect{% endblock %}

{% block content %}
<section>
    <div class="container">
        <div class="dashboard-header">
            <h1>Your Professional Profile</h1>
            <p class="text-muted">View and manage your professional information</p>
            <a href="/profile/edit/" class="btn btn-primary" style="margin-top: 1rem;">Edit Profile</a>
        </div>

        <!-- Basic Information -->
        <h2 style="margin-top: 3rem;">Basic Information</h2>
        <div class="grid">
            <div class="card">
                <h3 class="card-title">üë§ Personal Details</h3>
                <div id="personalInfo">
                    <p class="text-muted">Loading...</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">üìä Professional Overview</h3>
                <div id="professionalInfo">
                    <p class="text-muted">Loading...</p>
                </div>
            </div>
        </div>

        <!-- Professional Information -->
        <h2 style="margin-top: 3rem;">Professional Information</h2>
        <div class="card">
            <h3 class="card-title">üíº Career Details</h3>
            <div id="careerInfo">
                <p class="text-muted">Loading...</p>
            </div>
        </div>

        <!-- Academic & Qualifications -->
        <h2 style="margin-top: 3rem;">Academic & Qualifications</h2>
        <div class="grid">
            <div class="card">
                <h3 class="card-title">üéì Academic Qualifications</h3>
                <div id="academicInfo">
                    <p class="text-muted">Loading...</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">üìú Certifications & Licenses</h3>
                <div id="certificationsInfo">
                    <p class="text-muted">Loading...</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">üè¢ Professional Associations</h3>
                <div id="associationsInfo">
                    <p class="text-muted">Loading...</p>
                </div>
            </div>
        </div>

        <!-- Location Information -->
        <h2 style="margin-top: 3rem;">Location Information</h2>
        <div class="grid">
            <div class="card">
                <h3 class="card-title">üåç Practice Location</h3>
                <div id="locationInfo">
                    <p class="text-muted">Loading...</p>
                </div>
            </div>

            <div class="card">
                <h3 class="card-title">üì¨ Contact Address</h3>
                <div id="addressInfo">
                    <p class="text-muted">Loading...</p>
                </div>
            </div>
        </div>

        <!-- Additional Information -->
        <h2 style="margin-top: 3rem;">Additional Information</h2>
        <div class="card">
            <h3 class="card-title">üìù Professional Bio</h3>
            <div id="bioInfo">
                <p class="text-muted">Loading...</p>
            </div>
        </div>

        <div class="card" style="margin-top: 2rem;">
            <h3 class="card-title">üîó Portfolio & Links</h3>
            <div id="portfolioInfo">
                <p class="text-muted">Loading...</p>
            </div>
        </div>
    </div>
</section>

<script>
    const token = localStorage.getItem('token');

    if (token) {
        // Load profile
        fetch('/api/users/profiles/my_profile/', {
            headers: { 'Authorization': `Token ${token}` }
        })
        .then(res => res.json())
        .then(data => {
            const user = data.user;
            
            // Personal Information
            document.getElementById('personalInfo').innerHTML = `
                <p><strong>Name:</strong> ${user.first_name} ${user.last_name}</p>
                <p><strong>Email:</strong> ${user.email}</p>
                <p><strong>Username:</strong> ${user.username}</p>
                <p><strong>Phone:</strong> ${data.phone_number || 'Not provided'}</p>
            `;

            // Professional Overview
            document.getElementById('professionalInfo').innerHTML = `
                <p><strong>Engineer Type:</strong> ${data.engineer_type?.charAt(0).toUpperCase() + data.engineer_type?.slice(1) || 'Not specified'}</p>
                <p><strong>Specialization:</strong> ${data.specialization || 'Not specified'}</p>
                <p><strong>Experience:</strong> ${data.years_experience} years</p>
                <p><strong>Current Company:</strong> ${data.company || 'Not specified'}</p>
                <p><strong>Verified:</strong> ${data.is_verified ? '‚úì Yes' : '‚úó No'}</p>
            `;

            // Career Details
            document.getElementById('careerInfo').innerHTML = `
                <p><strong>Job Title:</strong> ${data.engineer_type?.charAt(0).toUpperCase() + data.engineer_type?.slice(1) || 'Not specified'}</p>
                <p><strong>Years of Experience:</strong> ${data.years_experience}</p>
                <p><strong>Organization:</strong> ${data.company || 'Not specified'}</p>
                <p><strong>Member Since:</strong> ${new Date(data.created_at).toLocaleDateString()}</p>
                <p><strong>Last Updated:</strong> ${new Date(data.updated_at).toLocaleDateString()}</p>
            `;

            // Academic Information
            document.getElementById('academicInfo').innerHTML = `
                <p>${data.academic_qualifications || '<em>No academic qualifications added yet.</em>'}</p>
            `;

            // Certifications
            document.getElementById('certificationsInfo').innerHTML = `
                <p>${data.certifications || '<em>No certifications added yet.</em>'}</p>
            `;

            // Professional Associations
            document.getElementById('associationsInfo').innerHTML = `
                <p>${data.professional_associations || '<em>No professional associations added yet.</em>'}</p>
            `;

            // Location Information
            document.getElementById('locationInfo').innerHTML = `
                <p><strong>Country:</strong> ${data.country_of_practice || 'Not specified'}</p>
                <p><strong>City/Location:</strong> ${data.location || 'Not specified'}</p>
            `;

            // Address Information
            document.getElementById('addressInfo').innerHTML = `
                <p>${data.postal_address ? data.postal_address.replace(/\n/g, '<br>') : '<em>No postal address provided.</em>'}</p>
            `;

            // Bio
            document.getElementById('bioInfo').innerHTML = `
                <p>${data.bio || '<em>No bio added yet.</em>'}</p>
            `;

            // Portfolio
            document.getElementById('portfolioInfo').innerHTML = `
                ${data.portfolio_url ? `<p><strong>Portfolio Website:</strong> <a href="${data.portfolio_url}" target="_blank">${data.portfolio_url}</a></p>` : '<p><em>No portfolio URL provided.</em></p>'}
            `;
        })
        .catch(err => {
            console.error('Error loading profile:', err);
            alert('Error loading profile data');
        });
    } else {
        window.location.href = '/login/';
    }
</script>
{% endblock %}
